#!/usr/bin/env php
<?php

declare(strict_types = 1);

/**
 * Complete code analysis script
 */

$commands = [
    'PHPStan' => 'composer phpstan analyse src tests --level=max',
    'PHP CodeSniffer' => 'composer phpcs src --standard=PSR12',
    'PHP CodeSniffer Fixer' => 'composer php-cs-fixer fix --dry-run --diff',
    'PHPMD' => 'composer phpmd src text phpmd.xml',
];

echo "\n";
echo "===============================================\n";
echo "CloudCastle HTTP Router - Code Analysis\n";
echo "===============================================\n\n";

foreach ($commands as $tool => $command) {
    echo "Running {$tool}...\n";
    echo str_repeat("-", 50) . "\n";
    
    $output = [];
    $returnVar = 0;
    exec($command . " 2>&1", $output, $returnVar);
    
    if ($returnVar === 0) {
        echo "✓ {$tool}: PASSED\n\n";
    } else {
        echo "✗ {$tool}: Issues found\n";
        echo implode("\n", array_slice($output, 0, 10)) . "\n";
        if (count($output) > 10) {
            echo "... (" . (count($output) - 10) . " more lines)\n";
        }
        echo "\n";
    }
}

echo "===============================================\n";
echo "Analysis Complete\n";
echo "===============================================\n";

