# Rate Limiting & Auto-Ban

[English](../../en/features/04_RATE_LIMITING.md) | [–†—É—Å—Å–∫–∏–π](../../ru/features/04_RATE_LIMITING.md) | **Deutsch** | [Fran√ßais](../../fr/features/04_RATE_LIMITING.md) | [‰∏≠Êñá](../../zh/features/04_RATE_LIMITING.md)

---







---

## üìö Dokumentationsnavigation

[README](../../README.md) | [USER_GUIDE](../USER_GUIDE.md) | [FEATURES_INDEX](../FEATURES_INDEX.md) | [API_REFERENCE](../API_REFERENCE.md) | [ALL_FEATURES](../ALL_FEATURES.md) | [TESTS_SUMMARY](../TESTS_SUMMARY.md) | [PERFORMANCE](../PERFORMANCE_ANALYSIS.md) | [SECURITY](../SECURITY_REPORT.md) | [COMPARISON](../COMPARISON.md) | [FAQ](../FAQ.md)

**Detaillierte Dokumentation:** [01](01_BASIC_ROUTING.md) | [02](02_ROUTE_PARAMETERS.md) | [03](03_ROUTE_GROUPS.md) | [04](04_RATE_LIMITING.md) | [05](05_IP_FILTERING.md) | [06](06_MIDDLEWARE.md) | [07](07_NAMED_ROUTES.md) | [08](08_TAGS.md) | [09](09_HELPER_FUNCTIONS.md) | [10](10_ROUTE_SHORTCUTS.md) | [11](11_ROUTE_MACROS.md) | [12](12_URL_GENERATION.md) | [13](13_EXPRESSION_LANGUAGE.md) | [14](14_CACHING.md) | [15](15_PLUGINS.md) | [16](16_LOADERS.md) | [17](17_PSR_SUPPORT.md) | [18](18_ACTION_RESOLVER.md) | [19](19_STATISTICS.md) | [20](20_SECURITY.md) | [21](21_EXCEPTIONS.md) | [22](22_CLI_TOOLS.md)

---


**Kategorie:** Sicherheit  
**Anzahl der Methoden:** 15  
**Komplexit√§t:** ‚≠ê‚≠ê‚≠ê Fortgeschritten —É—Ä–æ in –µ–Ω—å

---

## –û–ø und  mit –∞–Ω und –µ

Rate Limiting (–æ–≥—Ä–∞–Ω und —á–µ–Ω und –µ —á–∞ mit —Ç–æ—Ç—ã Anfragen)  und  Auto-Ban (–∞ in —Ç–æ–º–∞—Ç und —á–µ mit –∫–∞—è –±–ª–æ–∫ und —Ä–æ in –∫–∞) - —ç—Ç–æ –º–æ—â–Ω—ã–µ  in  mit —Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω und –∑–º—ã –∑–∞—â und —Ç—ã –æ—Ç DDoS –∞—Ç–∞–∫, –±—Ä—É—Ç-—Ñ–æ—Ä mit –∞  und  –∑–ª–æ—É nach —Ç—Ä–µ–±–ª–µ–Ω und –π API.

## Funktionen

### Rate Limiting (8 Methoden)

#### 1. –ë–∞–∑–æ in —ã–π throttle

**Methode:** `throttle(int $maxAttempts, int $decayMinutes, ?callable $keyResolver = null): Route`

**–û–ø und  mit –∞–Ω und –µ:** –û–≥—Ä–∞–Ω und —á–µ–Ω und –µ –∫–æ–ª und —á–µ mit —Ç in –∞ Anfragen –∫ Route—É.

**Parameter:**
- `$maxAttempts` - –ú–∞–∫ mit  und –º–∞–ª—å–Ω–æ–µ –∫–æ–ª und —á–µ mit —Ç in –æ Anfragen
- `$decayMinutes` - –ü–µ—Ä und –æ–¥  in —Ä–µ–º–µ–Ω und   in  –º und –Ω—É—Ç–∞—Ö
- `$keyResolver` - –û–ø—Ü und –æ auf –ª—å auf —è —Ñ—É–Ω–∫—Ü und —è  f√ºr  –æ–ø—Ä–µ–¥–µ–ª–µ–Ω und —è –∫–ª—é—á–∞ (standardm√§√üig IP)

**Beispiele:**

```php
// 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
Route::post('/api/submit', $action)
    ->throttle(60, 1);

// 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å
Route::post('/api/upload', $action)
    ->throttle(100, 60);

// 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
Route::get('/api/public', $action)
    ->throttle(1000, 1440);

// –° –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º
Route::post('/login', [AuthController::class, 'login'])
    ->throttle(5, 1);  // 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –≤ –º–∏–Ω—É—Ç—É
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä und  –∫–∞–∂–¥–æ–º Anfrage–µ —É in –µ–ª und —á und  in –∞–µ—Ç mit —è  mit —á–µ—Ç—á und –∫  f√ºr  IP ( oder  –∫–∞ mit —Ç–æ–º–Ω–æ–≥–æ –∫–ª—é—á–∞)
2. –ï mit –ª und   mit —á–µ—Ç—á und –∫ –ø—Ä–µ in —ã—à–∞–µ—Ç –ª und –º und —Ç -  in —ã–±—Ä–∞ mit —ã in –∞–µ—Ç mit —è `TooManyRequestsException`
3. –ß–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ  in —Ä–µ–º—è  mit —á–µ—Ç—á und –∫  mit –±—Ä–∞ mit —ã in –∞–µ—Ç mit —è

---

#### 2. TimeUnit enum

**Enum:** `CloudCastle\Http\Router\TimeUnit`

**–û–ø und  mit –∞–Ω und –µ:** –ü–µ—Ä–µ—á und  mit –ª–µ–Ω und –µ  f√ºr  —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã  mit   in —Ä–µ–º–µ–Ω–Ω—ã–º und  –µ–¥ und –Ω und —Ü–∞–º und .

**Werte:**
```php
TimeUnit::SECOND->value  // 1/60 –º–∏–Ω—É—Ç—ã
TimeUnit::MINUTE->value  // 1 –º–∏–Ω—É—Ç–∞
TimeUnit::HOUR->value    // 60 –º–∏–Ω—É—Ç
TimeUnit::DAY->value     // 1440 –º–∏–Ω—É—Ç
TimeUnit::WEEK->value    // 10080 –º–∏–Ω—É—Ç
TimeUnit::MONTH->value   // 43200 –º–∏–Ω—É—Ç
```

**Beispiele:**

```php
use CloudCastle\Http\Router\TimeUnit;

// 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
Route::post('/api/realtime', $action)
    ->throttle(5, TimeUnit::SECOND->value);

// 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
Route::post('/api/normal', $action)
    ->throttle(100, TimeUnit::MINUTE->value);

// 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å
Route::get('/api/hourly', $action)
    ->throttle(1000, TimeUnit::HOUR->value);

// 10000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
Route::get('/api/daily', $action)
    ->throttle(10000, TimeUnit::DAY->value);

// 50000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
Route::post('/api/weekly', $action)
    ->throttle(50000, TimeUnit::WEEK->value);

// 200000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–µ—Å—è—Ü
Route::post('/api/monthly', $action)
    ->throttle(200000, TimeUnit::MONTH->value);
```

**Vorteile:**
- –ß und —Ç–∞–µ–º–æ mit —Ç—å –∫–æ–¥–∞
- –ù–µ—Ç –º–∞–≥ und —á–µ mit –∫ und —Ö —á und  mit –µ–ª
- IDE –∞ in —Ç–æ–¥–æ nach –ª–Ω–µ–Ω und –µ

---

#### 3. Benutzerdefiniert –∫–ª—é—á throttle

**–û–ø und  mit –∞–Ω und –µ:** –ò mit  nach –ª—å–∑–æ in –∞–Ω und –µ –∫–∞ mit —Ç–æ–º–Ω–æ–π —Ñ—É–Ω–∫—Ü und  und   f√ºr  –æ–ø—Ä–µ–¥–µ–ª–µ–Ω und —è –∫–ª—é—á–∞ Einschr√§nkungen.

**Beispiele:**

```php
// –ü–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
Route::post('/api/user-action', $action)
    ->throttle(30, 1, function($request) {
        return 'user_' . ($request->userId ?? 'guest');
    });

// –ü–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ IP + User Agent
Route::post('/api/combined', $action)
    ->throttle(60, 1, function($request) {
        $ip = $request->ip();
        $ua = $_SERVER['HTTP_USER_AGENT'] ?? 'unknown';
        return md5($ip . $ua);
    });

// –ü–æ API –∫–ª—é—á—É
Route::post('/api/endpoint', $action)
    ->throttle(1000, 60, function($request) {
        $apiKey = $_SERVER['HTTP_X_API_KEY'] ?? 'default';
        return 'api_' . $apiKey;
    });

// –ü–æ email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
Route::post('/password/reset', $action)
    ->throttle(3, 60, function($request) {
        return 'reset_' . ($_POST['email'] ?? 'unknown');
    });

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
Route::post('/api/global', $action)
    ->throttle(10000, 1, fn() => 'global_limit');
```

**–ò mit  nach –ª—å–∑–æ in –∞–Ω und –µ:**
- –û–≥—Ä–∞–Ω und —á–µ–Ω und –µ  nach   nach –ª—å–∑–æ in –∞—Ç–µ–ª—é, –∞ –Ω–µ  nach  IP
- –ó–∞—â und —Ç–∞ –æ—Ç —Ä–∞ mit –ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∞—Ç–∞–∫
- –ì und –±–∫–æ–µ —É–ø—Ä–∞ in –ª–µ–Ω und –µ –ª und –º und —Ç–∞–º und 
- API –∫ in –æ—Ç—ã

---

#### 4. Abrufen RateLimiter

**Methode:** `getRateLimiter(): ?RateLimiter`

**–û–ø und  mit –∞–Ω und –µ:** Abrufen –æ–±—ä–µ–∫—Ç–∞ RateLimiter  f√ºr  –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

**Beispiele:**

```php
$route = Route::post('/api/data', $action)
    ->throttle(60, 1);

$rateLimiter = $route->getRateLimiter();

if ($rateLimiter) {
    // –†–∞–±–æ—Ç–∞ —Å RateLimiter
    $max = $rateLimiter->getMaxAttempts();        // 60
    $decay = $rateLimiter->getDecayMinutes();     // 1
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ IP
    $ip = '192.168.1.1';
    if ($rateLimiter->tooManyAttempts($ip)) {
        $seconds = $rateLimiter->availableIn($ip);
        echo "Retry after $seconds seconds";
    }
}
```

---

#### 5. Methoden RateLimiter –∫–ª–∞ mit  mit –∞

**–ö–ª–∞ mit  mit :** `CloudCastle\Http\Router\RateLimiter`

**Methoden:**

```php
use CloudCastle\Http\Router\RateLimiter;

// –°–æ–∑–¥–∞–Ω–∏–µ
$limiter = new RateLimiter(60, 1);  // 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞
$tooMany = $limiter->tooManyAttempts('192.168.1.1');
// true –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç

// –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
$limiter->attempt('192.168.1.1');

// –°–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å
$remaining = $limiter->remaining('192.168.1.1');
// 59, 58, 57...

// –ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–æ—Å—Ç—É–ø–Ω–æ
$seconds = $limiter->availableIn('192.168.1.1');
// 45 (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å 45 —Å–µ–∫—É–Ω–¥ –¥–æ —Å–±—Ä–æ—Å–∞)

// –°–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –¥–ª—è IP
$limiter->clear('192.168.1.1');

// –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
$limiter->clearAll();

// Erhalten –º–∞–∫—Å–∏–º—É–º
$max = $limiter->getMaxAttempts();  // 60

// Erhalten –ø–µ—Ä–∏–æ–¥
$decay = $limiter->getDecayMinutes();  // 1

// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å BanManager
$banManager = new BanManager(5, 3600);
$limiter->setBanManager($banManager);

// Erhalten BanManager
$banManager = $limiter->getBanManager();
```

**Beispiel  und  mit  nach –ª—å–∑–æ in –∞–Ω und —è:**

```php
Route::post('/api/action', function() {
    $route = Route::current();
    $limiter = $route->getRateLimiter();
    $ip = $_SERVER['REMOTE_ADDR'];
    
    if ($limiter && $limiter->tooManyAttempts($ip)) {
        $seconds = $limiter->availableIn($ip);
        $remaining = $limiter->remaining($ip);
        
        return response()->json([
            'error' => 'Too many requests',
            'retry_after' => $seconds,
            'remaining' => $remaining
        ], 429);
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
    $limiter?->attempt($ip);
    
    return 'Success';
})
->throttle(60, 1);
```

---

#### 6-8. Shortcuts  f√ºr  throttle

**Methoden:**
- `throttleStandard(): Route` - 60 Anfragen/–º und –Ω
- `throttleStrict(): Route` - 10 Anfragen/–º und –Ω
- `throttleGenerous(): Route` - 1000 Anfragen/–º und –Ω

**Beispiele:**

```php
// 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
Route::post('/api/standard', $action)
    ->throttleStandard();
// –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ: ->throttle(60, 1)

// 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (—Å—Ç—Ä–æ–≥–∏–π)
Route::post('/api/critical', $action)
    ->throttleStrict();
// –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ: ->throttle(10, 1)

// 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (—â–µ–¥—Ä—ã–π)
Route::post('/api/bulk', $action)
    ->throttleGenerous();
// –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ: ->throttle(1000, 1)
```

**–ò mit  nach –ª—å–∑–æ in –∞–Ω und –µ:**
- –ë—ã mit —Ç—Ä–∞—è  auf  mit —Ç—Ä–æ–π–∫–∞ –±–µ–∑ —Ü und —Ñ—Ä
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–µ mit –µ—Ç—ã
- –ß und —Ç–∞–µ–º—ã–π –∫–æ–¥

---

### Auto-Ban System (7 Methoden)

#### 1. –°–æ–∑–¥–∞–Ω und –µ BanManager

**–ö–ª–∞ mit  mit :** `CloudCastle\Http\Router\BanManager`

**–ö–æ–Ω mit —Ç—Ä—É–∫—Ç–æ—Ä:** `__construct(int $maxViolations = 5, int $banDuration = 3600)`

**Parameter:**
- `$maxViolations` - Anzahl der  auf —Ä—É—à–µ–Ω und –π –¥–æ –±–∞ auf  (default: 5)
- `$banDuration` - –î–ª und —Ç–µ–ª—å–Ω–æ mit —Ç—å –±–∞ auf   in   mit –µ–∫—É–Ω–¥–∞—Ö (default: 3600 = 1 —á–∞ mit )

**Beispiele:**

```php
use CloudCastle\Http\Router\BanManager;

// 5 –Ω–∞—Ä—É—à–µ–Ω–∏–π = –±–∞–Ω –Ω–∞ 1 —á–∞—Å
$banManager = new BanManager(5, 3600);

// 3 –Ω–∞—Ä—É—à–µ–Ω–∏—è = –±–∞–Ω –Ω–∞ 24 —á–∞—Å–∞
$banManager = new BanManager(3, 86400);

// 10 –Ω–∞—Ä—É—à–µ–Ω–∏–π = –±–∞–Ω –Ω–∞ 30 –º–∏–Ω—É—Ç
$banManager = new BanManager(10, 1800);

// 1 –Ω–∞—Ä—É—à–µ–Ω–∏–µ = –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –±–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞
$banManager = new BanManager(1, 0);
```

---

#### 2. –í–∫–ª—é—á–µ–Ω und –µ Auto-Ban

**Methode:** `enableAutoBan(int $violations): void`

**–û–ø und  mit –∞–Ω und –µ:** –ê–∫—Ç und  in  und —Ä—É–µ—Ç –∞ in —Ç–æ–º–∞—Ç und —á–µ mit –∫—É—é –±–ª–æ–∫ und —Ä–æ in –∫—É  nach  mit –ª–µ N  auf —Ä—É—à–µ–Ω und –π.

**Beispiele:**

```php
$banManager = new BanManager();

// –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–±–∞–Ω –ø–æ—Å–ª–µ 5 –Ω–∞—Ä—É—à–µ–Ω–∏–π
$banManager->enableAutoBan(5);

// –ü–æ—Å–ª–µ 5 –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π throttle - IP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–∞–Ω–∏—Ç—Å—è
```

---

#### 3. –†—É—á auf —è –±–ª–æ–∫ und —Ä–æ in –∫–∞ IP

**Methode:** `ban(string $ip, int $duration): void`

**Parameter:**
- `$ip` - IP –∞–¥—Ä–µ mit   f√ºr  –±–ª–æ–∫ und —Ä–æ in –∫ und 
- `$duration` - –î–ª und —Ç–µ–ª—å–Ω–æ mit —Ç—å –±–∞ auf   in   mit –µ–∫—É–Ω–¥–∞—Ö (0 =  auf alle–≥–¥–∞)

**Beispiele:**

```php
$banManager = new BanManager();

// –ó–∞–±–∞–Ω–∏—Ç—å –Ω–∞ 1 —á–∞—Å
$banManager->ban('1.2.3.4', 3600);

// –ó–∞–±–∞–Ω–∏—Ç—å –Ω–∞ —Å—É—Ç–∫–∏
$banManager->ban('5.6.7.8', 86400);

// –ó–∞–±–∞–Ω–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞
$banManager->ban('9.10.11.12', 0);

// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
if ($suspiciousActivity) {
    $banManager->ban($_SERVER['REMOTE_ADDR'], 7200);  // 2 —á–∞—Å–∞
}
```

---

#### 4. –†–∞–∑–±–ª–æ–∫ und —Ä–æ in –∫–∞ IP

**Methode:** `unban(string $ip): void`

**Beispiele:**

```php
// –†–∞–∑–±–∞–Ω–∏—Ç—å IP
$banManager->unban('1.2.3.4');

// –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
$bannedIps = $banManager->getBannedIps();
foreach ($bannedIps as $ip) {
    if (isWhitelisted($ip)) {
        $banManager->unban($ip);
    }
}
```

---

#### 5. –ü—Ä–æ in –µ—Ä–∫–∞ –±–∞ auf 

**Methode:** `isBanned(string $ip): bool`

**Beispiele:**

```php
use CloudCastle\Http\Router\Exceptions\BannedException;

$banManager = new BanManager();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ middleware
if ($banManager->isBanned($_SERVER['REMOTE_ADDR'])) {
    throw new BannedException('Your IP is banned');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
Route::post('/api/action', function() use ($banManager) {
    $ip = $_SERVER['REMOTE_ADDR'];
    
    if ($banManager->isBanned($ip)) {
        return response()->json([
            'error' => 'IP banned'
        ], 403);
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞
});
```

---

#### 6. Abrufen  mit –ø und  mit –∫–∞ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP

**Methode:** `getBannedIps(): array`

**Beispiele:**

```php
$bannedIps = $banManager->getBannedIps();
// ['1.2.3.4', '5.6.7.8', ...]

// –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω—É
foreach ($bannedIps as $ip) {
    echo "Banned: $ip<br>";
}

// –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª
file_put_contents('banned.txt', implode("\n", $bannedIps));

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
$count = count($bannedIps);
echo "Total banned IPs: $count";
```

---

#### 7. –û—á und  mit —Ç–∫–∞ alle—Ö –±–∞–Ω–æ in 

**Methode:** `clearAll(): void`

**Beispiele:**

```php
// –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –±–∞–Ω—ã
$banManager->clearAll();

// –û—á–∏—Å—Ç–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron)
if (date('H') === '00') {  // –í –ø–æ–ª–Ω–æ—á—å
    $banManager->clearAll();
}

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±–∞–Ω–æ–≤
$banManager->clearAll();  // –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü und —è Rate Limiting  und  Auto-Ban

### –ü–æ–ª–Ω—ã–π –ø—Ä und –º–µ—Ä

```php
use CloudCastle\Http\Router\BanManager;
use CloudCastle\Http\Router\Facade\Route;

// –°–æ–∑–¥–∞—Ç—å BanManager
$banManager = new BanManager(
    maxViolations: 5,      // 5 –Ω–∞—Ä—É—à–µ–Ω–∏–π
    banDuration: 3600      // –ë–∞–Ω –Ω–∞ 1 —á–∞—Å
);

// –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–±–∞–Ω
$banManager->enableAutoBan(5);

// –ú–∞—Ä—à—Ä—É—Ç —Å –∑–∞—â–∏—Ç–æ–π
Route::post('/login', [AuthController::class, 'login'])
    ->throttle(3, 1)  // 3 –ø–æ–ø—ã—Ç–∫–∏ –≤ –º–∏–Ω—É—Ç—É
    ->getRateLimiter()
    ?->setBanManager($banManager);

// –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ 5 —Ä–∞–∑ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∞–Ω –Ω–∞ 1 —á–∞—Å
```

### –°—Ü–µ auf —Ä und –π —Ä–∞–±–æ—Ç—ã:

1. **–ü–æ–ø—ã—Ç–∫–∞ 1-3:** –ù–æ—Ä–º–∞–ª—å auf —è —Ä–∞–±–æ—Ç–∞
2. **–ü–æ–ø—ã—Ç–∫–∞ 4:** –ü—Ä–µ in —ã—à–µ–Ω und –µ –ª und –º und —Ç–∞ ‚Üí `TooManyRequestsException`
3. **–ü–æ–ø—ã—Ç–∫ und  5-9:** –ù–∞—Ä—É—à–µ–Ω und —è  auf –∫–∞–ø–ª und  in –∞—é—Ç mit —è
4. **–ü–æ–ø—ã—Ç–∫–∞ 10:** 5-–µ  auf —Ä—É—à–µ–Ω und –µ ‚Üí **–ê in —Ç–æ–±–∞–Ω  auf  1 —á–∞ mit **
5. **–°–ª–µ–¥—É—é—â und –µ  nach –ø—ã—Ç–∫ und :** `BannedException`

---

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã  und  mit  nach –ª—å–∑–æ in –∞–Ω und —è

### 1. –ó–∞—â und —Ç–∞ –∞ in —Ç–æ—Ä und –∑–∞—Ü und  und 

```php
$banManager = new BanManager(3, 86400);  // 3 –Ω–µ—É–¥–∞—á–∏ = –±–∞–Ω –Ω–∞ —Å—É—Ç–∫–∏

Route::post('/login', [AuthController::class, 'login'])
    ->throttle(5, 1)
    ->getRateLimiter()
    ?->setBanManager($banManager);
```

### 2. API  mit  –∫ in –æ—Ç–∞–º und 

```php
// Free tier: 100 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
Route::group(['prefix' => '/api/free'], function() {
    Route::get('/data', $action)
        ->throttle(100, 60);
});

// Pro tier: 10000 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
Route::group(['prefix' => '/api/pro'], function() {
    Route::get('/data', $action)
        ->throttle(10000, 60);
});
```

### 3. –ó–∞—â und —Ç–∞ –æ—Ç –ø–∞—Ä mit  und –Ω–≥–∞

```php
Route::get('/products/{id}', [ProductController::class, 'show'])
    ->throttle(100, 1);  // –ù–µ –±–æ–ª–µ–µ 100 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É
```

### 4. –í–æ mit  mit —Ç–∞–Ω–æ in –ª–µ–Ω und –µ –ø–∞—Ä–æ–ª—è

```php
$banManager = new BanManager(3, 3600);

Route::post('/password/reset', [PasswordController::class, 'reset'])
    ->throttle(3, 60, fn($req) => 'reset_' . ($_POST['email'] ?? 'unknown'))
    ->getRateLimiter()
    ?->setBanManager($banManager);
```

### 5. –†–µ–≥ und  mit —Ç—Ä–∞—Ü und —è

```php
Route::post('/register', [RegisterController::class, 'store'])
    ->throttle(3, 60);  // 3 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —á–∞—Å —Å –æ–¥–Ω–æ–≥–æ IP
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞  und  mit –∫–ª—é—á–µ–Ω und –π

```php
use CloudCastle\Http\Router\Exceptions\TooManyRequestsException;
use CloudCastle\Http\Router\Exceptions\BannedException;

try {
    $route = Route::dispatch($_SERVER['REQUEST_URI'], $_SERVER['REQUEST_METHOD']);
    echo $route->run();
    
} catch (BannedException $e) {
    http_response_code(403);
    echo json_encode([
        'error' => 'IP banned',
        'message' => $e->getMessage()
    ]);
    
} catch (TooManyRequestsException $e) {
    http_response_code(429);
    $retryAfter = $e->getRetryAfter();
    header("Retry-After: $retryAfter");
    
    echo json_encode([
        'error' => 'Too many requests',
        'retry_after' => $retryAfter
    ]);
}
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü und  und 

### ‚úÖ –•–æ—Ä–æ—à und –µ –ø—Ä–∞–∫—Ç und –∫ und 

1. **–†–∞–∑–Ω—ã–µ –ª und –º und —Ç—ã  f√ºr  —Ä–∞–∑–Ω—ã—Ö —ç–Ω–¥ nach  und –Ω—Ç–æ in **
   ```php
   Route::get('/api/public', $action)->throttle(1000, 1);    // –©–µ–¥—Ä–æ
   Route::post('/login', $action)->throttle(5, 1);          // –°—Ç—Ä–æ–≥–æ
   Route::post('/api/write', $action)->throttle(60, 1);     // –°—Ä–µ–¥–Ω–µ
   ```

2. **–ò mit  nach –ª—å–∑—É–π—Ç–µ auto-ban  f√ºr  –∫—Ä und —Ç und —á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü und –π**
   ```php
   $banManager = new BanManager(3, 86400);
   Route::post('/admin/login', $action)
       ->throttle(3, 1)
       ->getRateLimiter()
       ?->setBanManager($banManager);
   ```

3. **–ö–∞ mit —Ç–æ–º–Ω—ã–µ –∫–ª—é—á und   f√ºr   nach –ª—å–∑–æ in –∞—Ç–µ–ª–µ–π**
   ```php
   Route::post('/api/action', $action)
       ->throttle(100, 1, fn($req) => 'user_' . $req->userId);
   ```

### ‚ùå Anti-Patterns

1. **–ù–µ  mit —Ç–∞ in —å—Ç–µ  mit –ª und —à–∫–æ–º –Ω und –∑–∫ und –µ –ª und –º und —Ç—ã**
   ```php
   // ‚ùå –ü–ª–æ—Ö–æ - –¥–∞–∂–µ –ª–µ–≥–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
   Route::get('/api/data', $action)->throttle(1, 1);
   ```

2. **–ù–µ –∑–∞–±—ã in –∞–π—Ç–µ –ø—Ä–æ API-–∫–ª—é—á und **
   ```php
   // ‚ùå –ü–ª–æ—Ö–æ - –ª–∏–º–∏—Ç –ø–æ IP, –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ—Ö
   Route::post('/api/endpoint', $action)->throttle(100, 1);
   
   // ‚úÖ –•–æ—Ä–æ—à–æ - –ª–∏–º–∏—Ç –ø–æ API-–∫–ª—é—á—É
   Route::post('/api/endpoint', $action)
       ->throttle(100, 1, fn($req) => 'api_' . $req->apiKey);
   ```

---

## Leistung

| –û–ø–µ—Ä–∞—Ü und —è | –í—Ä–µ–º—è | –ü–∞–º—è—Ç—å |
|----------|-------|--------|
| –ü—Ä–æ in –µ—Ä–∫–∞ throttle | ~640Œºs | ~3.5 MB |
| Ban check | ~100Œºs | ~1 MB |
| –î–æ–±–∞ in –ª–µ–Ω und –µ  in  ban list | ~50Œºs | ~200 KB |

**–í—ã in –æ–¥:** –ú und –Ω und –º–∞–ª—å–Ω–æ–µ  in –ª und —è–Ω und –µ  auf  –ø—Ä–æ und –∑ in –æ–¥ und —Ç–µ–ª—å–Ω–æ mit —Ç—å

---

## Sicherheit

### –ó–∞—â und —Ç–∞ –æ—Ç:

- ‚úÖ **DDoS –∞—Ç–∞–∫** - Rate limiting
- ‚úÖ **–ë—Ä—É—Ç-—Ñ–æ—Ä mit ** - Auto-ban  nach  mit –ª–µ  auf —Ä—É—à–µ–Ω und –π
- ‚úÖ **API abuse** - –ö in –æ—Ç—ã  nach  –∫–ª—é—á–∞–º
- ‚úÖ **–ü–∞—Ä mit  und –Ω–≥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –õ und –º und —Ç—ã  auf  —á—Ç–µ–Ω und –µ
- ‚úÖ **Spam** - –°—Ç—Ä–æ–≥ und –µ –ª und –º und —Ç—ã  auf  POST

---

## Siehe auch

- [IP Filtering](05_IP_FILTERING.md) - –î–æ nach –ª–Ω und —Ç–µ–ª—å auf —è –∑–∞—â und —Ç–∞  nach  IP
- [Middleware](06_MIDDLEWARE.md) - SecurityLogger, AuthMiddleware
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](20_SECURITY.md) - Gemeinsam –æ–±–∑–æ—Ä –±–µ–∑–æ–ø–∞ mit –Ω–æ mit —Ç und 
- [–ò—Å–∫–ª—é—á–µ–Ω–∏—è](21_EXCEPTIONS.md) - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à und –±–æ–∫

---

**Version:** 1.1.1  
**–î–∞—Ç–∞ –æ–±–Ω–æ in –ª–µ–Ω und —è:** –û–∫—Ç—è–±—Ä—å 2025  
**–°—Ç–∞—Ç—É mit :** ‚úÖ Production-ready


---

## üìö Dokumentationsnavigation

[README](../../README.md) | [USER_GUIDE](../USER_GUIDE.md) | [FEATURES_INDEX](../FEATURES_INDEX.md) | [API_REFERENCE](../API_REFERENCE.md) | [ALL_FEATURES](../ALL_FEATURES.md) | [TESTS_SUMMARY](../TESTS_SUMMARY.md) | [FAQ](../FAQ.md)

**Detaillierte Dokumentation:** [01](01_BASIC_ROUTING.md) | [02](02_ROUTE_PARAMETERS.md) | [03](03_ROUTE_GROUPS.md) | [04](04_RATE_LIMITING.md) | [05](05_IP_FILTERING.md) | [06](06_MIDDLEWARE.md) | [07](07_NAMED_ROUTES.md) | [08](08_TAGS.md) | [09](09_HELPER_FUNCTIONS.md) | [10](10_ROUTE_SHORTCUTS.md) | [11](11_ROUTE_MACROS.md) | [12](12_URL_GENERATION.md) | [13](13_EXPRESSION_LANGUAGE.md) | [14](14_CACHING.md) | [15](15_PLUGINS.md) | [16](16_LOADERS.md) | [17](17_PSR_SUPPORT.md) | [18](18_ACTION_RESOLVER.md) | [19](19_STATISTICS.md) | [20](20_SECURITY.md) | [21](21_EXCEPTIONS.md) | [22](22_CLI_TOOLS.md)

**¬© 2024 CloudCastle HTTP Router**
