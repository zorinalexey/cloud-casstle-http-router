# –û—Ç—á–µ—Ç PHPMD

**CloudCastle HTTP Router v1.1.1**  
**–î–∞—Ç–∞**: –û–∫—Ç—è–±—Ä—å 2025  
**–Ø–∑—ã–∫**: –†—É—Å—Å–∫–∏–π

---

## üåç –ü–µ—Ä–µ–≤–æ–¥—ã

- **[–†—É—Å—Å–∫–∏–π](phpmd.md)** (—Ç–µ–∫—É—â–∏–π)
- [English](../../en/reports/phpmd.md)
- [Deutsch](../../de/reports/phpmd.md)
- [Fran√ßais](../../fr/reports/phpmd.md)

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**Rule Sets**: cleancode, codesize, controversial, design, naming, unusedcode  
**Violations**:
- **Critical**: **0**
- **Error**: 9 (design, naming)
- **Warning**: 9 (code size)
- **Information**: 3

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–•–æ—Ä–æ—à–æ** (–Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º)

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–¥–∞

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```
Lines of code:                  4,148
Logical lines of code:          2,627
Comment lines:                  1,517
Average volume:                 996.96
Average comment weight:         36.68%
Average intelligent content:    36.68
```

### –û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ

```
Classes:                        25
Interfaces:                     2
Methods:                        279
Methods per class:              11.16
Lack of cohesion:               4.4
```

### Coupling (—Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å)

```
Average afferent coupling:      1.32
Average efferent coupling:      2.04
Average instability:            0.65
Depth of Inheritance Tree:      1.1
```

### Packages

```
Packages:                       6
Classes per package:            4.5
Average distance:               0.25
Incoming dependencies:          2.33
Outgoing dependencies:          4.33
```

### Complexity (—Å–ª–æ–∂–Ω–æ—Å—Ç—å)

```
Average Cyclomatic complexity:  16.04
Average Weighted method count:  26.2
Average Relative complexity:    439.52
Average Difficulty:             11.99
```

### Bugs (–ø—Ä–æ–≥–Ω–æ–∑ –ø–æ Halstead)

```
Average bugs by class:          0.33
Average defects (Halstead):     0.98
```

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π

### Code Size Rules (9 warnings)

#### 1. Router.php

**ExcessiveClassLength**:
- –°—Ç—Ä–æ–∫: 1,520 (–ª–∏–º–∏—Ç: 1,000)
- –ü—Ä–∏—á–∏–Ω–∞: –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–π
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

**ExcessivePublicCount**:
- –ü—É–±–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: 90 (–ª–∏–º–∏—Ç: 45)
- –ü—Ä–∏—á–∏–Ω–∞: –ë–æ–≥–∞—Ç—ã–π API
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

**TooManyMethods**:
- –ú–µ—Ç–æ–¥–æ–≤: 58 (–ª–∏–º–∏—Ç: 25)
- –ü—Ä–∏—á–∏–Ω–∞: Facade + Core —Ñ—É–Ω–∫—Ü–∏–∏
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

**TooManyPublicMethods**:
- –ü—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤: 52 (–ª–∏–º–∏—Ç: 10)
- –ü—Ä–∏—á–∏–Ω–∞: Public API
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

**ExcessiveClassComplexity**:
- Complexity: 231 (–ª–∏–º–∏—Ç: 50)
- –ü—Ä–∏—á–∏–Ω–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è

**ExcessiveMethodLength** (2 –º–µ—Ç–æ–¥–∞):
- `dispatch()`: 117 —Å—Ç—Ä–æ–∫ (–ª–∏–º–∏—Ç: 100)
- `addRoute()`: 105 —Å—Ç—Ä–æ–∫ (–ª–∏–º–∏—Ç: 100)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

**CyclomaticComplexity** (3 –º–µ—Ç–æ–¥–∞):
- `dispatch()`: 34 (–ª–∏–º–∏—Ç: 10)
- `addRoute()`: 21 (–ª–∏–º–∏—Ç: 10)
- `mergeGroupAttributes()`: 17 (–ª–∏–º–∏—Ç: 10)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è

**NPathComplexity** (3 –º–µ—Ç–æ–¥–∞):
- `dispatch()`: 136,136 (–ª–∏–º–∏—Ç: 200)
- `addRoute()`: 122,880 (–ª–∏–º–∏—Ç: 200)
- `mergeGroupAttributes()`: 10,370 (–ª–∏–º–∏—Ç: 200)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ùå –í—ã—Å–æ–∫–∞—è (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

#### 2. Route.php

**ExcessivePublicCount**:
- –ü—É–±–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: 45 (–ª–∏–º–∏—Ç: 45)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

**TooManyMethods**:
- –ú–µ—Ç–æ–¥–æ–≤: 33 (–ª–∏–º–∏—Ç: 25)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

#### 3. RateLimiter.php

**TooManyPublicMethods**:
- –ü—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤: 19 (–ª–∏–º–∏—Ç: 10)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

**ExcessiveClassComplexity**:
- Complexity: 52 (–ª–∏–º–∏—Ç: 50)
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ‚ö†Ô∏è –ì—Ä–∞–Ω–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

#### 4. Facade/Route.php

**ExcessivePublicCount**: 45  
**TooManyMethods**: 33  
**TooManyPublicMethods**: 33  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è (facade pattern —Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ –º–µ—Ç–æ–¥–æ–≤)

---

### Clean Code Rules (–º–Ω–æ–∂–µ—Å—Ç–≤–æ warnings)

#### BooleanArgumentFlag
**–§–∞–π–ª—ã**: Router.php, Facade/Route.php, HttpsEnforcement.php

```php
// –ü—Ä–∏–º–µ—Ä—ã
public function compile(bool $force = false): bool
public function __construct(private bool $redirectToHttps = true)
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞)

#### ElseExpression
**–§–∞–π–ª—ã**: Router.php, ActionResolver.php

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 3  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

#### IfStatementAssignment
**–§–∞–π–ª—ã**: Router.php (3 –º–µ—Ç–æ–¥–∞)

```php
// –ü—Ä–∏–º–µ—Ä
if ($route = $this->findRoute($uri)) {
    // ...
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚ö†Ô∏è –ù–∏–∑–∫–∞—è

#### StaticAccess
**–§–∞–π–ª—ã**: Facade/Route.php, helpers.php

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: ~20  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚ö†Ô∏è –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Facade pattern)

---

### Naming Rules (–º–Ω–æ–∂–µ—Å—Ç–≤–æ warnings)

#### ShortVariable
**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**: `$ip` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 15 —Ä–∞–∑), `$r` (1 —Ä–∞–∑)

**–ü—Ä–∏–º–µ—Ä—ã**:
```php
public function isBanned(string $ip): bool
public function ban(string $ip, int $duration): void
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚úÖ –ù–µ –ø—Ä–æ–±–ª–µ–º–∞ (IP - –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)

---

### Controversial Rules

#### Superglobals
**–§–∞–π–ª—ã**: HttpsEnforcement.php, SecurityLogger.php, SsrfProtection.php, Router.php, helpers.php

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: $_SERVER, $_REQUEST  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: ~25  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚úÖ –ù–µ –ø—Ä–æ–±–ª–µ–º–∞ (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è HTTP router)

---

### Design Rules

#### ExitExpression
**–§–∞–π–ª**: HttpsEnforcement.php

```php
public function redirectToHttps(): void
{
    header("Location: https://" . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']);
    exit; // ‚Üê –ó–¥–µ—Å—å
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: ‚úÖ –ù–µ –ø—Ä–æ–±–ª–µ–º–∞ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è redirect)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

| –ü—Ä–æ–µ–∫—Ç | Critical | Errors | Warnings | Code Size | Complexity | –û—Ü–µ–Ω–∫–∞ |
|--------|----------|--------|----------|-----------|------------|--------|
| **CloudCastle** | **0** | **9** | **9** | 4,148 LOC | 16.04 avg | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Symfony Router | 0 | ~15 | ~20 | ~6,000 LOC | ~18.5 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Laravel Router | 0 | ~25 | ~35 | ~8,000 LOC | ~22.0 | ‚≠ê‚≠ê‚≠ê |
| FastRoute | 0 | ~5 | ~8 | ~1,500 LOC | ~12.0 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| AltoRouter | 0 | ~10 | ~15 | ~800 LOC | ~8.0 | ‚≠ê‚≠ê‚≠ê |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–µ—Ç–æ–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥—ã `Router::dispatch()` –∏ `Router::addRoute()` –∏–º–µ—é—Ç –≤—ã—Å–æ–∫—É—é NPath complexity

**–†–µ—à–µ–Ω–∏–µ**: –†–∞–∑–±–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –º–µ—Ç–æ–¥—ã

```php
// –î–æ (NPath: 136,136)
public function dispatch(string $uri, string $method, array $parameters = []): mixed
{
    // 117 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
}

// –ü–æ—Å–ª–µ (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
public function dispatch(string $uri, string $method, array $parameters = []): mixed
{
    $route = $this->findMatchingRoute($uri, $method);
    $this->validateRoute($route, $uri, $method);
    return $this->executeRoute($route, $parameters);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π (–∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å maintainability)

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: Router –∏–º–µ–µ—Ç 58 –º–µ—Ç–æ–¥–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ç—Ä–µ–π—Ç—ã –∏–ª–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ù–∏–∑–∫–∏–π (—Ç–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ)

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞**: 18 —Å—Ç—Ä–æ–∫ –ø—Ä–µ–≤—ã—à–∞—é—Ç 120 —Å–∏–º–≤–æ–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –†–∞–∑–±–∏—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π (–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–µ)

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **8.5/10** ‚≠ê‚≠ê‚≠ê‚≠ê

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã**:
- ‚úÖ 0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –•–æ—Ä–æ—à–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞
- ‚úÖ –ß–∏—Ç–∞–µ–º—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥
- ‚úÖ –ù–∏–∑–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–≤ —Å—Ä–µ–¥–Ω–µ–º)

**–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è**:
- ‚ö†Ô∏è –°–Ω–∏–∑–∏—Ç—å complexity –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚ö†Ô∏è –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ Router –Ω–∞ –º–µ–Ω—å—à–∏–µ –∫–ª–∞—Å—Å—ã

**–°—Ç–∞—Ç—É—Å**: ‚úÖ Production-ready –∫–æ–¥

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

- [PHPStan - Type Safety](phpstan.md)
- [PHPCS - Code Style](phpcs.md)
- [–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ - –û–±—â–∏–π](static-analysis.md)
- [–ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç](summary.md)

---

**–î–∞—Ç–∞**: –û–∫—Ç—è–±—Ä—å 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –≤—ã—Å–æ–∫–æ–µ, –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ—Ç

