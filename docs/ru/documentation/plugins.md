# –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤

**CloudCastle HTTP Router v1.1.1**  
**–î–∞—Ç–∞**: –°–µ–Ω—Ç—è–±—Ä—å 2025  
**–Ø–∑—ã–∫**: –†—É—Å—Å–∫–∏–π

---

## üåç –ü–µ—Ä–µ–≤–æ–¥—ã

- **[–†—É—Å—Å–∫–∏–π](../../ru/documentation/plugins.md)** (—Ç–µ–∫—É—â–∏–π)
- **[English](../../en/documentation/plugins.md)**
- **[Deutsch](../../de/documentation/plugins.md)**
- **[Fran√ßais](../../fr/documentation/plugins.md)**

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#–±–∞–∑–æ–≤—ã–µ-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
3. [–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã](#–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ-–ø–ª–∞–≥–∏–Ω—ã)
4. [–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ-–ø–ª–∞–≥–∏–Ω–∞)
5. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª](#–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª)
6. [API Reference](#api-reference)
7. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ CloudCastle Router –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–æ—É—Ç–µ—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞. –ü–ª–∞–≥–∏–Ω—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ—é –ª–æ–≥–∏–∫—É.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- üîå **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è core
- üéØ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –≤–∫–ª—é—á–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã
- üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø–ª–∞–≥–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
- üîß **–ì–∏–±–∫–æ—Å—Ç—å** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–≤–æ–∏ –ø–ª–∞–≥–∏–Ω—ã –ø–æ–¥ –∑–∞–¥–∞—á–∏
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Ä–∞–±–æ—Ç—É —Ä–æ—É—Ç–µ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### PluginInterface

–í—Å–µ –ø–ª–∞–≥–∏–Ω—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PluginInterface`:

```php
interface PluginInterface
{
    public function getName(): string;
    public function getVersion(): string;
    public function boot(Router $router): void;
    public function isEnabled(): bool;
    public function enable(): void;
    public function disable(): void;
    
    // Lifecycle hooks
    public function onRouteRegistered(Route $route): void;
    public function beforeDispatch(Route $route, string $uri, string $method): void;
    public function afterDispatch(Route $route, mixed $result): mixed;
    public function onException(\Exception $exception): void;
}
```

### AbstractPlugin

–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤:

```php
use CloudCastle\Http\Router\Plugin\AbstractPlugin;

class MyPlugin extends AbstractPlugin
{
    public function getName(): string
    {
        return 'my_plugin';
    }
    
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    public function beforeDispatch(Route $route, string $uri, string $method): void
    {
        // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
    }
}
```

---

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã

### LoggerPlugin

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ä–æ—É—Ç–µ—Ä–∞.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
- –í—ã–±–æ—Ä —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**

```php
use CloudCastle\Http\Router\Plugin\LoggerPlugin;

$logger = new LoggerPlugin('/var/log/router.log');

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞
$logger->setLogRouteRegistration(true);   // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –º–∞—Ä—à—Ä—É—Ç–æ–≤
$logger->setLogDispatches(true);          // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—é
$logger->setLogExceptions(true);          // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è

$router->registerPlugin($logger);
```

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**

```
[2025-09-01 12:00:00] [ROUTE REGISTERED] GET|POST /api/users -> users.api
[2025-09-01 12:00:01] [BEFORE DISPATCH] GET /api/users -> Route: users.api
[2025-09-01 12:00:01] [AFTER DISPATCH] Route: users.api, Result Type: array
[2025-09-01 12:00:05] [EXCEPTION] RouteNotFoundException: Route not found for URI: /invalid
```

---

### AnalyticsPlugin

–°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫ —Ä–∞–±–æ—Ç—ã —Ä–æ—É—Ç–µ—Ä–∞.

**–°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–π
- –•–∏—Ç—ã –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ HTTP –º–µ—Ç–æ–¥–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
- –°–∞–º—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–µ—Ç–æ–¥
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**

```php
use CloudCastle\Http\Router\Plugin\AnalyticsPlugin;

$analytics = new AnalyticsPlugin();
$router->registerPlugin($analytics);

// ... —Ä–∞–±–æ—Ç–∞ —Å —Ä–æ—É—Ç–µ—Ä–æ–º ...

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
$stats = $analytics->getStatistics();

echo "–í—Å–µ–≥–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–π: {$stats['total_dispatches']}\n";
echo "–í—Å–µ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π: {$stats['total_exceptions']}\n";
echo "–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç: {$stats['most_popular_route']}\n";
echo "–°–∞–º—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–µ—Ç–æ–¥: {$stats['most_used_method']}\n";
echo "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {$stats['average_execution_time']}s\n";

// –•–∏—Ç—ã –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º
foreach ($stats['route_hits'] as $route => $hits) {
    echo "$route: $hits —Ö–∏—Ç–æ–≤\n";
}

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Ç–æ–¥–æ–≤
foreach ($stats['method_stats'] as $method => $count) {
    echo "$method: $count –∑–∞–ø—Ä–æ—Å–æ–≤\n";
}

// –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
$analytics->reset();
```

---

### ResponseCachePlugin

–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏–ª–∏ –≤—ã–±–æ—Ä–æ—á–Ω–æ
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (TTL)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞
- –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É

**–ü—Ä–∏–º–µ—Ä:**

```php
use CloudCastle\Http\Router\Plugin\ResponseCachePlugin;

$cache = new ResponseCachePlugin(
    defaultTtl: 300,      // 5 –º–∏–Ω—É—Ç
    cacheAllRoutes: false  // –ù–µ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ
);

// –£–∫–∞–∑–∞—Ç—å –∫–∞–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å
$cache->setCacheableRoutes(['users.list', 'posts.index', 'api.data']);

// –ò–ª–∏ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ
$cache->cacheAllRoutes(true);

$router->registerPlugin($cache);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
$route = $router->getRoute('users.list');
if ($cache->isCached($route)) {
    $result = $cache->getCachedResponse($route);
}

// –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
$cache->clearCache();                  // –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
$cache->clearRouteCache($route);       // –û—á–∏—Å—Ç–∏—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
$stats = $cache->getCacheStats();
echo "–í—Å–µ–≥–æ –≤ –∫–µ—à–µ: {$stats['total_cached']}\n";
echo "–ê–∫—Ç–∏–≤–Ω—ã—Ö: {$stats['active']}\n";
echo "–£—Å—Ç–∞—Ä–µ–≤—à–∏—Ö: {$stats['expired']}\n";
```

---

## –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–≥–∏–Ω

```php
use CloudCastle\Http\Router\Plugin\AbstractPlugin;
use CloudCastle\Http\Router\Route;

class RequestCounterPlugin extends AbstractPlugin
{
    private int $count = 0;
    
    public function getName(): string
    {
        return 'request_counter';
    }
    
    public function beforeDispatch(Route $route, string $uri, string $method): void
    {
        $this->count++;
    }
    
    public function getCount(): int
    {
        return $this->count;
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
$counter = new RequestCounterPlugin();
$router->registerPlugin($counter);

// –ü–æ–∑–∂–µ
echo "–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤: " . $counter->getCount();
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–ª–∞–≥–∏–Ω

```php
class PerformanceMonitorPlugin extends AbstractPlugin
{
    private array $timings = [];
    private array $slowRoutes = [];
    private float $threshold = 0.5; // 500ms
    
    public function getName(): string
    {
        return 'performance_monitor';
    }
    
    public function getVersion(): string
    {
        return '1.0.0';
    }
    
    public function beforeDispatch(Route $route, string $uri, string $method): void
    {
        $key = $this->getRouteKey($route);
        $this->timings[$key] = microtime(true);
    }
    
    public function afterDispatch(Route $route, mixed $result): mixed
    {
        $key = $this->getRouteKey($route);
        
        if (isset($this->timings[$key])) {
            $duration = microtime(true) - $this->timings[$key];
            
            if ($duration > $this->threshold) {
                $this->slowRoutes[$key] = [
                    'route' => $route->getName() ?? $route->getUri(),
                    'duration' => $duration,
                    'threshold' => $this->threshold,
                    'timestamp' => time(),
                ];
                
                // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                $this->notifySlow($route, $duration);
            }
            
            unset($this->timings[$key]);
        }
        
        return $result;
    }
    
    public function getSlowRoutes(): array
    {
        return $this->slowRoutes;
    }
    
    public function setThreshold(float $threshold): self
    {
        $this->threshold = $threshold;
        return $this;
    }
    
    private function getRouteKey(Route $route): string
    {
        return md5($route->getUri() . implode(',', $route->getMethods()));
    }
    
    private function notifySlow(Route $route, float $duration): void
    {
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –ª–æ–≥, etc.
        error_log(sprintf(
            "Slow route detected: %s took %.2fs (threshold: %.2fs)",
            $route->getName() ?? $route->getUri(),
            $duration,
            $this->threshold
        ));
    }
}
```

### –ü–ª–∞–≥–∏–Ω —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

```php
class SecurityAuditPlugin extends AbstractPlugin
{
    private array $config;
    private array $events = [];
    
    public function __construct(array $config = [])
    {
        $this->config = array_merge([
            'log_file' => '/var/log/security.log',
            'alert_email' => null,
            'track_ips' => true,
            'track_user_agents' => false,
        ], $config);
    }
    
    public function getName(): string
    {
        return 'security_audit';
    }
    
    public function beforeDispatch(Route $route, string $uri, string $method): void
    {
        $event = [
            'timestamp' => time(),
            'uri' => $uri,
            'method' => $method,
            'route' => $route->getName(),
        ];
        
        if ($this->config['track_ips']) {
            $event['ip'] = $_SERVER['REMOTE_ADDR'] ?? 'unknown';
        }
        
        if ($this->config['track_user_agents']) {
            $event['user_agent'] = $_SERVER['HTTP_USER_AGENT'] ?? 'unknown';
        }
        
        $this->events[] = $event;
        $this->writeToLog($event);
    }
    
    public function onException(\Exception $exception): void
    {
        $this->writeToLog([
            'type' => 'exception',
            'class' => get_class($exception),
            'message' => $exception->getMessage(),
            'timestamp' => time(),
        ]);
        
        if ($this->config['alert_email']) {
            $this->sendAlert($exception);
        }
    }
    
    private function writeToLog(array $event): void
    {
        file_put_contents(
            $this->config['log_file'],
            json_encode($event) . "\n",
            FILE_APPEND
        );
    }
    
    private function sendAlert(\Exception $exception): void
    {
        mail(
            $this->config['alert_email'],
            'Security Alert: ' . get_class($exception),
            $exception->getMessage()
        );
    }
}
```

---

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ —Ö—É–∫–æ–≤

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞**
   ```
   Router::get() ‚Üí Plugin::onRouteRegistered()
   ```

2. **–î–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è**
   ```
   Router::dispatch() ‚Üí Plugin::beforeDispatch()
   ```

3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**
   ```
   Router::executeRoute() ‚Üí Middleware ‚Üí Action
   ```

4. **–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
   ```
   Action result ‚Üí Plugin::afterDispatch() ‚Üí return
   ```

5. **–ü—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏**
   ```
   Exception ‚Üí Plugin::onException() ‚Üí throw
   ```

### –î–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Router::get('/users')          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ onRouteRegistered  ‚îÇ ‚óÑ‚îÄ‚îÄ All enabled plugins
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Router::dispatch('/users', 'GET') ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  beforeDispatch    ‚îÇ ‚óÑ‚îÄ‚îÄ All enabled plugins
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Router::executeRoute($route)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ    Middleware      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ      Action        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  afterDispatch     ‚îÇ ‚óÑ‚îÄ‚îÄ All enabled plugins
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Return result               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

     (On exception at any point)
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   onException      ‚îÇ ‚óÑ‚îÄ‚îÄ All enabled plugins
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## API Reference

### Router –º–µ—Ç–æ–¥—ã

```php
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞
$router->registerPlugin(PluginInterface $plugin): self

// –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞
$router->unregisterPlugin(string $name): self

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–ª–∞–≥–∏–Ω–∞
$router->hasPlugin(string $name): bool

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ –ø–æ –∏–º–µ–Ω–∏
$router->getPlugin(string $name): ?PluginInterface

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
$router->getPlugins(): array
```

### Plugin –º–µ—Ç–æ–¥—ã

```php
// –ë–∞–∑–æ–≤—ã–µ
getName(): string                    // –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–ª–∞–≥–∏–Ω–∞
getVersion(): string                 // –í–µ—Ä—Å–∏—è –ø–ª–∞–≥–∏–Ω–∞
boot(Router $router): void          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
isEnabled(): bool                   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
enable(): void                      // –í–∫–ª—é—á–∏—Ç—å –ø–ª–∞–≥–∏–Ω
disable(): void                     // –í—ã–∫–ª—é—á–∏—Ç—å –ø–ª–∞–≥–∏–Ω

// –•—É–∫–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
onRouteRegistered(Route $route): void
beforeDispatch(Route $route, string $uri, string $method): void
afterDispatch(Route $route, mixed $result): mixed
onException(\Exception $exception): void
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```php
use CloudCastle\Http\Router\Router;
use CloudCastle\Http\Router\Plugin\LoggerPlugin;
use CloudCastle\Http\Router\Plugin\AnalyticsPlugin;

$router = Router::getInstance();

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤
$router->registerPlugin(new LoggerPlugin('/tmp/router.log'));
$router->registerPlugin(new AnalyticsPlugin());

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
$router->get('/users', 'UserController@index')->name('users.index');
$router->get('/posts', 'PostController@index')->name('posts.index');

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
$route = $router->dispatch('/users', 'GET');
$result = $router->executeRoute($route);

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
$analytics = $router->getPlugin('analytics');
$stats = $analytics->getStatistics();
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã

```php
$logger = new LoggerPlugin('/var/log/router.log');
$analytics = new AnalyticsPlugin();
$cache = new ResponseCachePlugin(300);
$monitor = new PerformanceMonitorPlugin();

$router
    ->registerPlugin($logger)
    ->registerPlugin($analytics)
    ->registerPlugin($cache)
    ->registerPlugin($monitor);

// –í—Å–µ –ø–ª–∞–≥–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
```

### –£—Å–ª–æ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è

```php
$analytics = new AnalyticsPlugin();
$router->registerPlugin($analytics);

// –í production - –≤–∫–ª—é—á–∏—Ç—å
if (ENV === 'production') {
    $analytics->enable();
} else {
    $analytics->disable();
}

// –ò–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
if ($request->header('X-Debug')) {
    $router->getPlugin('analytics')->enable();
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```php
class SentryPlugin extends AbstractPlugin
{
    private \Sentry\Client $sentry;
    
    public function __construct(\Sentry\Client $sentry)
    {
        $this->sentry = $sentry;
    }
    
    public function getName(): string
    {
        return 'sentry';
    }
    
    public function onException(\Exception $exception): void
    {
        $this->sentry->captureException($exception);
    }
    
    public function beforeDispatch(Route $route, string $uri, string $method): void
    {
        $this->sentry->addBreadcrumb([
            'category' => 'router',
            'message' => "Dispatching $method $uri",
            'level' => 'info',
        ]);
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
$sentry = \Sentry\init(['dsn' => 'your-dsn']);
$router->registerPlugin(new SentryPlugin($sentry));
```

### –¶–µ–ø–æ—á–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤

```php
// –ü–ª–∞–≥–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
$router
    ->registerPlugin(new AuthPlugin())      // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ auth
    ->registerPlugin(new RateLimitPlugin()) // 2. Rate limiting
    ->registerPlugin(new LoggerPlugin())    // 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    ->registerPlugin(new AnalyticsPlugin()) // 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    ->registerPlugin(new CachePlugin());    // 5. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## Best Practices

### 1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤

‚úÖ **–•–æ—Ä–æ—à–æ:**
```php
public function getName(): string {
    return 'my_company_plugin';  // –£–Ω–∏–∫–∞–ª—å–Ω–æ, snake_case
}
```

‚ùå **–ü–ª–æ—Ö–æ:**
```php
public function getName(): string {
    return 'plugin';  // –°–ª–∏—à–∫–æ–º –æ–±—â–µ–µ
}
```

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

‚úÖ **–•–æ—Ä–æ—à–æ:**
```php
public function beforeDispatch(Route $route, string $uri, string $method): void
{
    if (!$this->shouldProcess($route)) {
        return;  // –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥
    }
    
    // –õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
}
```

‚ùå **–ü–ª–æ—Ö–æ:**
```php
public function beforeDispatch(Route $route, string $uri, string $method): void
{
    // –¢—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
    $this->database->query(...);
    $this->api->call(...);
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

‚úÖ **–•–æ—Ä–æ—à–æ:**
```php
public function afterDispatch(Route $route, mixed $result): mixed
{
    try {
        // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
        return $result;
    } catch (\Exception $e) {
        error_log($e->getMessage());
        return $result;  // –ù–µ –ª–æ–º–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π flow
    }
}
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

‚úÖ **–•–æ—Ä–æ—à–æ:**
```php
class MyPlugin extends AbstractPlugin
{
    public function __construct(
        private array $config = []
    ) {
        // –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        $this->config = array_merge([
            'enabled' => true,
            'log_level' => 'info',
        ], $config);
    }
}
```

---

## FAQ

**Q: –ú–æ–≥—É—Ç –ª–∏ –ø–ª–∞–≥–∏–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è?**

A: –î–∞, –º–µ—Ç–æ–¥ `afterDispatch()` –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```php
public function afterDispatch(Route $route, mixed $result): mixed
{
    return array_merge($result, ['plugin' => 'added_data']);
}
```

**Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–ª–∞–≥–∏–Ω –≤—Ä–µ–º–µ–Ω–Ω–æ?**

A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `disable()` –∏ `enable()`:

```php
$plugin = $router->getPlugin('analytics');
$plugin->disable();

// ... –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è ...

$plugin->enable();
```

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã —Å Facade?**

A: –î–∞, –ø–ª–∞–≥–∏–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ singleton Router, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Facade:

```php
use CloudCastle\Http\Router\Facade\Route;

Route::getInstance()->registerPlugin(new MyPlugin());
```

**Q: –í –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–ª–∞–≥–∏–Ω—ã?**

A: –í –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ï—Å–ª–∏ –≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –Ω—É–∂–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

---

## –°–º. —Ç–∞–∫–∂–µ

- [API Reference](api-reference.md)
- [Middleware](middleware.md)
- [–ü—Ä–∏–º–µ—Ä—ã](../../../examples/)
- [–¢–µ—Å—Ç—ã –ø–ª–∞–≥–∏–Ω–æ–≤](../../../tests/Unit/PluginSystemTest.php)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: –°–µ–Ω—Ç—è–±—Ä—å 2025  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –û–∫—Ç—è–±—Ä—å 2025

