PHP Warning:  PHP Startup: Unable to load dynamic library 'libvirt-php.so' (tried: /usr/lib/php/20240924/libvirt-php.so (/usr/lib/php/20240924/libvirt-php.so: cannot open shared object file: No such file or directory), /usr/lib/php/20240924/libvirt-php.so.so (/usr/lib/php/20240924/libvirt-php.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0
PHPUnit 10.5.58 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.13
Configuration: /home/alexey/Документы/Projects/Cursor/HttpRouter/phpunit.xml

...............................................................  63 / 233 ( 27%)
............................................................... 126 / 233 ( 54%)
............................................................... 189 / 233 ( 81%)
......................E...FFEEF.E.EE.E..EFFE                    233 / 233 (100%)

Time: 00:01.799, Memory: 14.00 MB

Action Resolver (CloudCastle\Http\Router\Tests\Unit\ActionResolver)
 ✔ Resolve closure
 ✔ Resolve closure with parameters
 ✔ Resolve array with class
 ✔ Resolve array with instance
 ✔ Resolve string with at separator
 ✔ Resolve string with double colon separator
 ✔ Invalid action throws exception
 ✔ Invalid string format throws exception
 ✔ Non existent method throws exception

Cache Integration (CloudCastle\Http\Router\Tests\Integration\CacheIntegration)
 ✘ Full cache cycle
   │
   │ CloudCastle\Http\Router\Exceptions\RouteNotFoundException: Route not found for URI: /api/data
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:526
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/CacheIntegrationTest.php:61
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✔ Cache invalidation
 ✔ Auto caching
 ✔ Cache with complex routes
 ✘ Concurrent cache access
   │
   │ Failed asserting that false is true.
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/CacheIntegrationTest.php:141
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │

Full Stack (CloudCastle\Http\Router\Tests\Integration\FullStack)
 ✘ Complete api setup
   │
   │ Failed asserting that two strings are equal.
   │ --- Expected
   │ +++ Actual
   │ @@ @@
   │ -'/api/v1/users'
   │ +'api/v1/users'
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/FullStackTest.php:43
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ Multi domain application
   │
   │ CloudCastle\Http\Router\Exceptions\RouteNotFoundException: Route not found for URI: /v1/users
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:526
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/FullStackTest.php:70
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ Complete security stack
   │
   │ CloudCastle\Http\Router\Exceptions\RouteNotFoundException: Route not found for URI: /admin/dashboard
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:526
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/FullStackTest.php:89
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ Cache workflow
   │
   │ Failed asserting that false is true.
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/FullStackTest.php:119
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✔ Rate limiting integration
 ✘ Complete routing workflow
   │
   │ CloudCastle\Http\Router\Exceptions\RouteNotFoundException: Route not found for URI: /users/123
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:526
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/FullStackTest.php:168
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✔ Filtering workflow

Helpers (CloudCastle\Http\Router\Tests\Unit\Helpers)
 ✔ Route helper
 ✔ Route helper without name
 ✔ Current route helper
 ✔ Previous route helper
 ✔ Route is helper
 ✔ Route name helper
 ✔ Router helper
 ✔ Route url helper
 ✔ Route url with multiple parameters
 ✔ Route has helper
 ✔ Route stats helper
 ✔ Routes by tag helper
 ✔ Route back helper
 ✔ Route back with default
 ✔ Dispatch route helper
 ✔ Dispatch route helper with query string

Maximum Security (CloudCastle\Http\Router\Tests\Integration\MaximumSecurity)
 ✘ OWASP A01 AccessControl
   │
   │ CloudCastle\Http\Router\Exceptions\InsecureConnectionException: HTTPS required for this route
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:478
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/MaximumSecurityTest.php:44
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ OWASP A02 CryptographicFailures
   │
   │ CloudCastle\Http\Router\Exceptions\InsecureConnectionException: HTTPS required for this route
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:430
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/MaximumSecurityTest.php:61
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✔ OWASP A02 InsecureConnection
 ✘ OWASP A07 RateLimitingProtection
   │
   │ CloudCastle\Http\Router\Exceptions\TooManyRequestsException: Too many requests
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:439
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/MaximumSecurityTest.php:81
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✔ OWASP A09 SecurityLogging
 ✔ OWASP A10 SSRFProtection
 ✘ Complete security stack
   │
   │ CloudCastle\Http\Router\Exceptions\InsecureConnectionException: HTTPS required for this route
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:478
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/MaximumSecurityTest.php:146
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ Protocol enforcement for web socket
   │
   │ Failed asserting that exception of type "CloudCastle\Http\Router\Exceptions\InsecureConnectionException" is thrown.
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ Secure web socket only
   │
   │ Failed asserting that exception of type "CloudCastle\Http\Router\Exceptions\InsecureConnectionException" is thrown.
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │
 ✘ Combined https and port enforcement
   │
   │ CloudCastle\Http\Router\Exceptions\InsecureConnectionException: HTTPS required for this route
   │
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Router.php:430
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/src/Facade/Route.php:149
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/tests/Integration/MaximumSecurityTest.php:208
   │ /home/alexey/Документы/Projects/Cursor/HttpRouter/vendor/bin/phpunit:122
   │

Middleware Dispatcher (CloudCastle\Http\Router\Tests\Unit\MiddlewareDispatcher)
 ✔ Dispatch without middleware
 ✔ Dispatch with single middleware
 ✔ Middleware chain
 ✔ Middleware order
 ✔ Add middleware

Protocol Support (CloudCastle\Http\Router\Tests\Unit\ProtocolSupport)
 ✔ Protocol setting
 ✔ Https only route
 ✔ Http or https route
 ✔ Web socket protocol
 ✔ Secure web socket protocol
 ✔ Protocol validation
 ✔ Dispatch with https requirement
 ✔ Dispatch with protocol restriction
 ✔ Group with https requirement
 ✔ Group with protocol
 ✔ Secure shortcut
 ✔ Protocol inheritance in nested groups
 ✔ No protocol restriction

Rate Limiter (CloudCastle\Http\Router\Tests\Unit\RateLimiter)
 ✔ Basic rate limiting
 ✔ Remaining attempts
 ✔ Too many attempts
 ✔ Clear attempts
 ✔ Available in
 ✔ Multiple users
 ✔ Custom key
 ✔ Attempts count
 ✔ Reset all

Route (CloudCastle\Http\Router\Tests\Unit\Route)
 ✔ Route creation
 ✔ Route with multiple methods
 ✔ Route matching
 ✔ Route parameter extraction
 ✔ Route with regex constraint
 ✔ Multiple parameters extraction
 ✔ Route naming
 ✔ Route tagging
 ✔ Route tagging with array
 ✔ Route middleware
 ✔ Route domain
 ✔ Route port
 ✔ Route whitelist ip
 ✔ Route blacklist ip
 ✔ Route without constraints
 ✔ Fluent interface

Route Cache (CloudCastle\Http\Router\Tests\Unit\RouteCache)
 ✔ Cache creation
 ✔ Cache not exists initially
 ✔ Put and get cache
 ✔ Clear cache
 ✔ Enable disable cache
 ✔ Cache freshness
 ✔ Get non existent cache
 ✔ Custom cache file

Route Collection (CloudCastle\Http\Router\Tests\Unit\RouteCollection)
 ✔ Add route
 ✔ Exact match
 ✔ Exact match not found
 ✔ Get by name
 ✔ Get by name not found
 ✔ Iterator
 ✔ Countable
 ✔ Array access
 ✔ Array access unset
 ✔ All
 ✔ Parameterized routes not indexed

Route Compiler (CloudCastle\Http\Router\Tests\Unit\RouteCompiler)
 ✔ Compile simple route
 ✔ Compile named route
 ✔ Compile tagged route
 ✔ Restore routes
 ✔ Compile closure route
 ✔ Compile array action
 ✔ Compile with middleware
 ✔ Compile metadata

Route Group (CloudCastle\Http\Router\Tests\Unit\RouteGroup)
 ✔ Group creation
 ✔ Group with middleware
 ✔ Group with domain
 ✔ Group with port
 ✔ Group with throttle
 ✔ Group with tags
 ✔ Group with ip whitelist
 ✔ Group with ip blacklist
 ✔ Fluent interface
 ✔ Apply to route

Route Macros (CloudCastle\Http\Router\Tests\Unit\RouteMacros)
 ✔ Resource macro
 ✔ Resource macro methods
 ✔ Api resource macro
 ✔ Api resource rate limits
 ✔ Crud macro
 ✔ Auth macro
 ✔ Auth macro rate limiting
 ✔ Admin panel macro
 ✔ Api version macro
 ✔ Webhooks macro
 ✔ Multiple macros combined

Route Shortcuts (CloudCastle\Http\Router\Tests\Unit\RouteShortcuts)
 ✔ Auth shortcut
 ✔ Guest shortcut
 ✔ Api shortcut
 ✔ Web shortcut
 ✔ Cors shortcut
 ✔ Localhost shortcut
 ✔ Secure shortcut
 ✔ Throttle standard shortcut
 ✔ Throttle strict shortcut
 ✔ Throttle generous shortcut
 ✔ Public shortcut
 ✔ Private shortcut
 ✔ Admin shortcut
 ✔ Api endpoint shortcut
 ✔ Protected shortcut
 ✔ Chained shortcuts

Router (CloudCastle\Http\Router\Tests\Unit\Router)
 ✔ Get route
 ✔ Post route
 ✔ Put route
 ✔ Patch route
 ✔ Delete route
 ✔ View route
 ✔ Custom route
 ✔ Match route
 ✔ Any route
 ✔ Route group
 ✔ Nested route groups
 ✔ Group with middleware
 ✔ Group with domain
 ✔ Group with port
 ✔ Dispatch successful
 ✔ Dispatch route not found
 ✔ Dispatch method not allowed
 ✔ Dispatch ip not allowed
 ✔ Dispatch with domain
 ✔ Dispatch with wrong domain
 ✔ Dispatch with port
 ✔ Dispatch with wrong port
 ✔ Named route
 ✔ Tagged routes
 ✔ Get all routes
 ✔ Global middleware
 ✔ Singleton pattern
 ✔ Reset singleton

Router Filtering (CloudCastle\Http\Router\Tests\Unit\RouterFiltering)
 ✔ Current route
 ✔ Current route named
 ✔ Previous route
 ✔ Previous route named
 ✔ Route history
 ✔ Get routes by method
 ✔ Get routes by domain
 ✔ Get routes by port
 ✔ Get routes by whitelisted ip
 ✔ Get routes by blacklisted ip
 ✔ Get routes by middleware
 ✔ Get throttled routes
 ✔ Get routes by prefix
 ✔ Get routes with ip restrictions
 ✔ Get routes with domain
 ✔ Get routes with port
 ✔ Get route stats
 ✔ Search routes
 ✔ Has route
 ✔ Has tag
 ✔ Get all tags
 ✔ Get all domains
 ✔ Get all ports
 ✔ Get routes by uri pattern
 ✔ Complex search

Router Get All Routes (CloudCastle\Http\Router\Tests\Unit\RouterGetAllRoutes)
 ✔ Get routes
 ✔ Get routes as array
 ✔ Count
 ✔ Get routes as json
 ✔ Get routes grouped by method
 ✔ Get routes grouped by prefix
 ✔ Get routes grouped by domain
 ✔ Static facade get routes
 ✔ Static facade get routes as array
 ✔ Static facade get routes as json
 ✔ Empty router

Security Middleware (CloudCastle\Http\Router\Tests\Unit\SecurityMiddleware)
 ✔ Https enforcement with https
 ✔ Https enforcement with http
 ✔ Https enforcement with forwarded proto
 ✔ Https enforcement with forwarded ssl
 ✔ Security logger creation
 ✔ Security logger logs request
 ✔ Security logger logs exception
 ✔ Ssrf protection allows normal requests
 ✔ Ssrf protection blocks localhost url
 ✔ Ssrf protection blocks private ip
 ✔ Ssrf protection blocks metadata endpoint
 ✔ Ssrf protection with whitelist
 ✔ Ssrf protection rejects non whitelisted domain
 ✔ Ssrf protection blocks file protocol
 ✔ Ssrf protection allows subdomains

There was 1 PHPUnit test runner warning:

1) XDEBUG_MODE=coverage (environment variable) or xdebug.mode=coverage (PHP configuration setting) has to be set

ERRORS!
Tests: 233, Assertions: 539, Errors: 9, Failures: 5, PHPUnit Warnings: 1, PHPUnit Deprecations: 1.
